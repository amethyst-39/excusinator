<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body>
    <!-- component -->
    <div class="font-sans bg-white flex flex-col min-h-screen w-full">
      <div>
        <div class="bg-gray-200 md:overflow-hidden">
          <div class="px-4 py-8">
            <div
              class="flex flex-col items-center relative w-full md:max-w-2xl md:mx-auto text-center"
            >
              <h1
                class="font-bold text-gray-700 text-lg sm:text-2xl md:text-4xl leading-tight mb-6"
              >
                Excusinator
              </h1>

              <p class="text-gray-600 md:text-md md:px-16">
                Tired of coming up with excuses for work? Wanna go to that party
                you have been waiting for or just lay in bed without the hassle
                of making up a new excuse every time? We got you covered!
              </p>

              <button
                onclick="handleAuthClick()"
                id="authorize_button"
                type="button"
                class="text-white bg-[#4285F4] hover:bg-[#4285F4]/90 focus:ring-4 focus:outline-none focus:ring-[#4285F4]/50 font-medium rounded-lg text-sm px-5 py-2.5 text-center inline-flex items-center dark:focus:ring-[#4285F4]/55 mr-2 mt-6"
              >
                <svg
                  class="mr-2 -ml-1 w-4 h-4"
                  aria-hidden="true"
                  focusable="false"
                  data-prefix="fab"
                  data-icon="google"
                  role="img"
                  xmlns="http://www.w3.org/2000/svg"
                  viewBox="0 0 488 512"
                >
                  <path
                    fill="currentColor"
                    d="M488 261.8C488 403.3 391.1 504 248 504 110.8 504 0 393.2 0 256S110.8 8 248 8c66.8 0 123 24.5 166.3 64.9l-67.5 64.9C258.5 52.6 94.3 116.6 94.3 256c0 86.5 69.1 156.6 153.7 156.6 98.2 0 135-70.4 140.8-106.9H248v-85.3h236.1c2.3 12.7 3.9 24.9 3.9 41.4z"
                  ></path>
                </svg>
                Sign in with Google
              </button>

              <button
                onclick="handleSignoutClick()"
                id="signout_button"
                type="button"
                class="text-white bg-[#4285F4] hover:bg-[#4285F4]/90 focus:ring-4 focus:outline-none focus:ring-[#4285F4]/50 font-medium rounded-lg text-sm px-5 py-2.5 text-center inline-flex items-center dark:focus:ring-[#4285F4]/55 mr-2 -mt-6"
              >
                <svg
                  class="mr-2 -ml-1 w-4 h-4"
                  aria-hidden="true"
                  focusable="false"
                  data-prefix="fab"
                  data-icon="google"
                  role="img"
                  xmlns="http://www.w3.org/2000/svg"
                  viewBox="0 0 488 512"
                >
                  <path
                    fill="currentColor"
                    d="M488 261.8C488 403.3 391.1 504 248 504 110.8 504 0 393.2 0 256S110.8 8 248 8c66.8 0 123 24.5 166.3 64.9l-67.5 64.9C258.5 52.6 94.3 116.6 94.3 256c0 86.5 69.1 156.6 153.7 156.6 98.2 0 135-70.4 140.8-106.9H248v-85.3h236.1c2.3 12.7 3.9 24.9 3.9 41.4z"
                  ></path>
                </svg>
                Sign out
              </button>

              <div
                class="hidden md:block h-40 w-40 rounded-full bg-blue-800 absolute right-0 bottom-0 -mb-52 -mr-48"
              ></div>

              <div
                class="hidden md:block h-5 w-5 rounded-full bg-yellow-500 absolute top-0 right-0 -mr-40 mt-32"
              ></div>

              <div
                class="hidden md:block h-5 w-5 rounded-full bg-yellow-400 absolute top-0 left-0 -ml-40 mt-32"
              ></div>

              <div
                class="hidden md:block h-10 w-10 rounded-full bg-blue-500 absolute top-16 left-32 -mr-40 mt-32"
              ></div>
            </div>
          </div>

          <svg
            class="fill-current bg-gray-200 text-white hidden md:block"
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 1440 320"
          >
            <path
              fill-opacity="1"
              d="M0,64L120,85.3C240,107,480,149,720,149.3C960,149,1200,107,1320,85.3L1440,64L1440,320L1320,320C1200,320,960,320,720,320C480,320,240,320,120,320L0,320Z"
            ></path>
          </svg>
        </div>

        <div
          class="max-w-4xl mx-auto bg-white shadow-lg relative z-20 hidden md:block"
          style="margin-top: -320px; border-radius: 20px"
        >
          <div
            class="h-20 w-20 rounded-full bg-yellow-500 absolute top-0 left-0 -ml-10 -mt-10"
            style="z-index: -1"
          ></div>

          <div
            class="h-5 w-5 rounded-full bg-blue-500 absolute top-0 left-0 -ml-32 mt-12"
            style="z-index: -1"
          ></div>

          <div
            class="flex flex-col items-center justify-center h-10 bg-white rounded-t-lg border-b border-gray-100"
          >
            <div class="group group-hover:block inline-block relative">
              <button
                class="bg-transparent border border-blue-500 text-blue-500 py-1 px-4 rounded"
              >
                Instructions
              </button>
              <div
                class="z-10 p-3 group-hover:block absolute mt-1 -ml-[21.3rem] hidden w-[50rem] h-[22rem] bg-gradient-to-b from-gray-200 via-white to-gray-200 rounded-lg"
              >
                <div class="flex flex-row">
                  <div class="w-1/3">
                    <img
                      class="h-[16rem] ml-12 mt-5"
                      src="assets/images/doof.png"
                    />
                  </div>
                  <div
                    class="flex flex-col justify-evenly py-12 px-10 w-2/3 text-lg text-gray-600 font-mono"
                  >
                    <h1>Step 1) Sign in with your Google account</h1>
                    <h1>Step 2) Select category of excuse</h1>
                    <h1>Step 3) Enter recepient email</h1>
                    <h1>
                      Step 4) Add context to email. For example,
                      &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;"I will be late
                      to work because"
                    </h1>
                    <h1>
                      Step 5) Hit send and let Excusinator come up
                      &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;with a creative
                      excuse for you!
                    </h1>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div
            class="flex flex-col justify-evenly items-center mb-5 p-10"
            style="height: 380px"
          >
            <form class="flex flex-col items-center w-[35rem]">
              <ul
                class="items-center w-full text-sm font-medium text-gray-900 bg-white rounded-lg border border-gray-200 sm:flex dark:bg-gray-700 dark:border-gray-600 dark:text-white mb-5"
              >
                <li
                  class="w-full border-b border-gray-200 sm:border-b-0 sm:border-r dark:border-gray-600"
                >
                  <div class="flex items-center pl-3">
                    <input
                      checked
                      id="horizontal-list-radio-friendsfam"
                      type="radio"
                      value="friendsfam"
                      name="list-radio"
                      class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-700 focus:ring-2 dark:bg-gray-600 dark:border-gray-500"
                    />
                    <label
                      for="horizontal-list-radio-friendsfam"
                      class="py-3 ml-2 w-full text-sm font-medium text-gray-900 dark:text-gray-300"
                      >Friends / Family</label
                    >
                  </div>
                </li>
                <li
                  class="w-full border-b border-gray-200 sm:border-b-0 sm:border-r dark:border-gray-600"
                >
                  <div class="flex items-center pl-3">
                    <input
                      id="horizontal-list-radio-work"
                      type="radio"
                      value="work"
                      name="list-radio"
                      class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-700 focus:ring-2 dark:bg-gray-600 dark:border-gray-500"
                    />
                    <label
                      for="horizontal-list-radio-work"
                      class="py-3 ml-2 w-full text-sm font-medium text-gray-900 dark:text-gray-300"
                      >Work</label
                    >
                  </div>
                </li>
                <li class="w-full dark:border-gray-600">
                  <div class="flex items-center pl-3">
                    <input
                      id="horizontal-list-radio-college"
                      type="radio"
                      value="college"
                      name="list-radio"
                      class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-700 focus:ring-2 dark:bg-gray-600 dark:border-gray-500"
                    />
                    <label
                      for="horizontal-list-radio-college"
                      class="py-3 ml-2 w-full text-sm font-medium text-gray-900 dark:text-gray-300"
                      >College</label
                    >
                  </div>
                </li>
              </ul>

              <div class="relative z-0 mb-6 w-full group">
                <input
                  type="email"
                  name="email"
                  id="email"
                  class="block py-2.5 px-0 w-full text-sm text-gray-900 bg-transparent border-0 border-b-2 border-gray-300 appearance-none dark:text-white dark:border-gray-600 dark:focus:border-blue-500 focus:outline-none focus:ring-0 focus:border-blue-600 peer"
                  placeholder=" "
                  required=""
                />
                <label
                  for="email"
                  class="peer-focus:font-medium absolute text-sm text-gray-500 dark:text-gray-400 duration-300 transform -translate-y-6 scale-75 top-3 -z-10 origin-[0] peer-focus:left-0 peer-focus:text-blue-600 peer-focus:dark:text-blue-500 peer-placeholder-shown:scale-100 peer-placeholder-shown:translate-y-0 peer-focus:scale-75 peer-focus:-translate-y-6"
                  >Email address</label
                >
              </div>
              <div class="relative z-0 mb-6 w-full group">
                <input
                  type="text"
                  name="subject"
                  id="subject"
                  class="block py-2.5 px-0 w-full text-sm text-gray-900 bg-transparent border-0 border-b-2 border-gray-300 appearance-none dark:text-white dark:border-gray-600 dark:focus:border-blue-500 focus:outline-none focus:ring-0 focus:border-blue-600 peer"
                  placeholder=" "
                  required=""
                />
                <label
                  for="subject"
                  class="peer-focus:font-medium absolute text-sm text-gray-500 dark:text-gray-400 duration-300 transform -translate-y-6 scale-75 top-3 -z-10 origin-[0] peer-focus:left-0 peer-focus:text-blue-600 peer-focus:dark:text-blue-500 peer-placeholder-shown:scale-100 peer-placeholder-shown:translate-y-0 peer-focus:scale-75 peer-focus:-translate-y-6"
                  >Subject</label
                >
              </div>
              <div class="relative z-0 mb-6 w-full group">
                <input
                  type="text"
                  name="context"
                  id="context"
                  class="block py-2.5 px-0 w-full text-sm text-gray-900 bg-transparent border-0 border-b-2 border-gray-300 appearance-none dark:text-white dark:border-gray-600 dark:focus:border-blue-500 focus:outline-none focus:ring-0 focus:border-blue-600 peer"
                  placeholder=" "
                  required=""
                />
                <label
                  for="context"
                  class="peer-focus:font-medium absolute text-sm text-gray-500 dark:text-gray-400 duration-300 transform -translate-y-6 scale-75 top-3 -z-10 origin-[0] peer-focus:left-0 peer-focus:text-blue-600 peer-focus:dark:text-blue-500 peer-placeholder-shown:scale-100 peer-placeholder-shown:translate-y-0 peer-focus:scale-75 peer-focus:-translate-y-6"
                  >Context</label
                >
              </div>

              <div
                onclick="sendEmail()"
                class="hover:cursor-pointer text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm w-full sm:w-auto px-5 py-2.5 text-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800"
              >
                SEND!
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>

    <!-- Scripts -->
    <script type="text/javascript">
      /* exported gapiLoaded */
      /* exported gisLoaded */
      /* exported handleAuthClick */
      /* exported handleSignoutClick */

      const excuses = {
        friendsfam: [
          "I am busy with some urgent work.",
          "my cat died.",
          "I am busy stalking my neighbour.",
          "I am constipated.",
          "I hate you.",
          "a fortune teller told me it's an unlucky day.",
          "I need to attend my boss's pet's funeral.",
          "my wig flew off in the wind and this is very embarrassing.",
          "I don't want to spoil my mood.",
          "I am busy gambling my savings.",
          "I woke up with a good mood and I don't want to ruin it.",
        ],
        work: [
          "I am busy stalking my neighbour.",
          "my grandma died.",
          "I hate my boss.",
          "Grandma tried to poison me. Again.",
          "there is a spider in my room and it's staring at me.",
          "I broke my arm trying to grab a sandwich.",
          "I need to attend my cousin's pet's funeral.",
          "my wig flew off in the wind and this is very embarrassing.",
          "my fish is unwell.",
          "I have better things to do.",
          "I woke up with a good mood and I don't want to ruin it.",
        ],
        college: [
          "I am busy stalking my neighbour.",
          "my grandma died.",
          "I hate my professor.",
          "Grandma tried to poison me. Again.",
          "there is a spider in my room and it's staring at me.",
          "I broke my arm trying to grab a sandwich.",
          "I need to attend my cousin's pet's funeral.",
          "I am suffering from a hangover.",
          "I slept late last night.",
          "a single sheet of paper can't decide my future.",
          "I woke up with a good mood and I don't want to ruin it.",
        ],
      };

      // TODO(developer): Set to client ID and API key from the Developer Console
      const CLIENT_ID = "SECRET";
      const API_KEY = "SECRET";

      // Discovery doc URL for APIs used by the quickstart
      const DISCOVERY_DOC =
        "https://www.googleapis.com/discovery/v1/apis/gmail/v1/rest";

      // Authorization scopes required by the API; multiple scopes can be
      // included, separated by spaces.
      const SCOPES =
        "https://www.googleapis.com/auth/gmail.metadata " +
        "https://www.googleapis.com/auth/gmail.send";

      let tokenClient;
      let gapiInited = false;
      let gisInited = false;

      document.getElementById("authorize_button").style.visibility = "visible";
      document.getElementById("signout_button").style.visibility = "hidden";

      /**
       * Callback after api.js is loaded.
       */
      function gapiLoaded() {
        gapi.load("client", intializeGapiClient);
      }

      /**
       * Callback after the API client is loaded. Loads the
       * discovery doc to initialize the API.
       */
      async function intializeGapiClient() {
        await gapi.client.init({
          apiKey: API_KEY,
          discoveryDocs: [DISCOVERY_DOC],
        });
        gapiInited = true;
        maybeEnableButtons();
      }

      /**
       * Callback after Google Identity Services are loaded.
       */
      function gisLoaded() {
        tokenClient = google.accounts.oauth2.initTokenClient({
          client_id: CLIENT_ID,
          scope: SCOPES,
          callback: "", // defined later
        });
        gisInited = true;
        maybeEnableButtons();
      }

      /**
       * Enables user interaction after all libraries are loaded.
       */
      function maybeEnableButtons() {
        if (gapiInited && gisInited) {
          document.getElementById("authorize_button").style.visibility =
            "visible";
        }
      }

      /**
       *  Sign in the user upon button click.
       */
      function handleAuthClick() {
        tokenClient.callback = async (resp) => {
          if (resp.error !== undefined) {
            throw resp;
          }
          document.getElementById("signout_button").style.visibility =
            "visible";
          document.getElementById("authorize_button").style.visibility =
            "hidden";
          //   await sendEmail();
        };

        if (gapi.client.getToken() === null) {
          // Prompt the user to select a Google Account and ask for consent to share their data
          // when establishing a new session.
          tokenClient.requestAccessToken({ prompt: "consent" });
        } else {
          // Skip display of account chooser and consent dialog for an existing session.
          tokenClient.requestAccessToken({ prompt: "" });
        }
      }

      /**
       *  Sign out the user upon button click.
       */
      function handleSignoutClick() {
        const token = gapi.client.getToken();
        if (token !== null) {
          google.accounts.oauth2.revoke(token.access_token);
          gapi.client.setToken("");
          document.getElementById("signout_button").style.visibility = "hidden";
          document.getElementById("authorize_button").style.visibility =
            "visible";
          document.getElementById("email").value = "";
          document.getElementById("subject").value = "";
          document.getElementById("context").value = "";
        }
      }

      async function sendEmail() {
        try {
          await gapi.client.gmail.users.getProfile({ userId: "me" }).then(
            (res) => {
              const fromEmail = res.result.emailAddress;
              let valid_excuse;
              let random = Math.floor(Math.random() * 11);
              if (
                document.getElementById("horizontal-list-radio-friendsfam")
                  .checked == true
              )
                valid_excuse = excuses.friendsfam[random];
              else if (
                document.getElementById("horizontal-list-radio-work").checked ==
                true
              )
                valid_excuse = excuses.work[random];
              else if (
                document.getElementById("horizontal-list-radio-college")
                  .checked == true
              )
                valid_excuse = excuses.college[random];
              let contact = document.getElementById("email").value;
              let subject = document.getElementById("subject").value;
              let context = document.getElementById("context").value;
              console.log("from:" + fromEmail);
              const message =
                "To: " +
                contact +
                "\r\n" +
                "Subject: " +
                subject +
                "\r\n\r\n" +
                "Hello,\n\n" +
                context +
                " " +
                valid_excuse +
                " I hope you understand.\n\nRegards.";

              // The body needs to be base64url encoded.
              const encodedMessage = btoa(message)
                .replace(/\+/g, "-")
                .replace(/\//g, "_")
                .replace(/=+$/, "");

              let response;
              gapi.client.gmail.users.messages
                .send({
                  userId: "me",
                  resource: {
                    raw: encodedMessage,
                  },
                })
                .then(
                  function (response) {
                    console.log("Message sent.");
                    alert("Your mail has been sent!");
                    document.getElementById("email").value = "";
                    document.getElementById("subject").value = "";
                    document.getElementById("context").value = "";
                  },
                  function (error) {
                    alert("Error! Couldn't send the mail.");
                    console.log("err" + error);
                  }
                );
            },
            (err) => {
              alert("Are you sure you have signed in?");
              console.log("no acc");
            }
          );
        } catch (err) {
          console.log("here" + err);
          return;
        }
      }
    </script>
    <script
      async
      defer
      src="https://apis.google.com/js/api.js"
      onload="gapiLoaded()"
    ></script>
    <script
      async
      defer
      src="https://accounts.google.com/gsi/client"
      onload="gisLoaded()"
    ></script>
  </body>
</html>
